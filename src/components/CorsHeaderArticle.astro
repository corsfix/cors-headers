---
export interface HeaderData {
  name: string;
  slug: string;
  description: string; // Combines tldr and why
  syntax: string[];
  examples: {
    client?: string;
    server?: string;
  };
  errors: Array<{ msg: string; fix: string }>;
  related: Array<{ name: string; slug: string }>;
  faq: Array<{ q: string; a: string }>;
}

export interface Props {
  data: HeaderData;
}

let baseUrl = import.meta.env.BASE_URL;
if (baseUrl.length > 1 && baseUrl.endsWith("/")) {
  baseUrl = baseUrl.slice(0, -1);
}

const { data } = Astro.props;
---

<main class="text-gray-900 font-sans px-4 sm:px-6 py-8 max-w-6xl mx-auto">
  <!-- Title block -->
  <header class="mb-10">
    <h1 class="text-3xl sm:text-4xl font-semibold text-gray-900">
      {data.name}
    </h1>
  </header>

  <article class="space-y-10">
    <!-- DESCRIPTION -->
    <section id="description" class="space-y-4">
      <p class="text-base leading-relaxed text-gray-600">{data.description}</p>
    </section>

    <!-- SYNTAX -->
    <section id="syntax" class="space-y-4">
      <h2 class="text-xl font-semibold text-gray-900">
        <a
          href="#syntax"
          class="hover:text-gray-600 transition-colors"
          aria-label="Link to Syntax & allowed values section"
        >
          Syntax & allowed values
        </a>
      </h2>
      <ul class="list-none space-y-2">
        {
          data.syntax.map((s) => (
            <li>
              <code class="bg-gray-50 border border-gray-200 px-3 py-1.5 rounded text-sm text-gray-800 font-mono">
                {s}
              </code>
            </li>
          ))
        }
      </ul>
    </section>

    <!-- CODE EXAMPLES -->
    <section id="examples" class="space-y-4">
      <h2 class="text-xl font-semibold text-gray-900">
        <a
          href="#examples"
          class="hover:text-gray-600 transition-colors"
          aria-label="Link to Code examples section"
        >
          Code examples
        </a>
      </h2>
      <div class="space-y-4">
        {
          data.examples.server && (
            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">SERVER</h3>
              <pre class="bg-gray-50 border border-gray-200 rounded-lg p-4 overflow-x-auto text-sm font-mono text-gray-800 whitespace-pre-wrap">
                {data.examples.server}
              </pre>
            </div>
          )
        }
        {
          data.examples.client && (
            <div>
              <h3 class="text-sm font-medium text-gray-700 mb-2">CLIENT</h3>
              <pre class="bg-gray-50 border border-gray-200 rounded-lg p-4 overflow-x-auto text-sm font-mono text-gray-800 whitespace-pre-wrap">
                {data.examples.client}
              </pre>
            </div>
          )
        }
      </div>
    </section>

    <!-- ERRORS -->
    {
      data.errors.length > 0 && (
        <section id="errors" class="space-y-4">
          <h2 class="text-xl font-semibold text-gray-900">
            <a
              href="#errors"
              class="hover:text-gray-600 transition-colors"
              aria-label="Link to Common errors & fixes section"
            >
              Common errors & fixes
            </a>
          </h2>
          {data.errors.map(({ msg, fix }) => (
            <div class="bg-white border border-gray-200 rounded-lg p-5">
              <h3 class="text-base font-medium text-gray-900 mb-2">{msg}</h3>
              <p class="text-sm leading-relaxed text-gray-600">{fix}</p>
            </div>
          ))}
        </section>
      )
    }

    <!-- RELATED HEADERS -->
    <section id="related" class="space-y-4">
      <h2 class="text-xl font-semibold text-gray-900">
        <a
          href="#related"
          class="hover:text-gray-600 transition-colors"
          aria-label="Link to Related headers section"
        >
          Related headers
        </a>
      </h2>
      <ul class="space-y-2">
        {
          data.related.map(({ name, slug }) => (
            <li>
              <a
                href={`${baseUrl}/${slug}`}
                class="text-gray-700 hover:text-gray-900 transition-colors"
              >
                {name}
              </a>
            </li>
          ))
        }
      </ul>
    </section>

    <!-- FAQ -->
    <section id="faq" class="space-y-4">
      <h2 class="text-xl font-semibold text-gray-900">
        <a
          href="#faq"
          class="hover:text-gray-600 transition-colors"
          aria-label="Link to Frequently asked questions section"
        >
          Frequently asked questions
        </a>
      </h2>
      {
        data.faq.map(({ q, a }, index) => (
          <details
            class="bg-white border border-gray-200 rounded-lg p-5"
            open={index === 0}
          >
            <summary class="cursor-pointer font-medium text-gray-900">
              {q}
            </summary>
            <p class="mt-3 text-sm leading-relaxed text-gray-600">{a}</p>
          </details>
        ))
      }
    </section>
  </article>
</main>
