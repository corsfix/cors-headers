---
import { marked } from "marked";

export interface HeaderData {
  name: string;
  slug: string;
  description: string; // Combines tldr and why
  syntax: { description: string; code: string };
  examples: {
    client?: string;
    server?: string;
  };
  errors: Array<{ msg: string; fix: string }>;
  faq: Array<{ q: string; a: string }>;
}

export interface Props {
  data: HeaderData;
}

let baseUrl = import.meta.env.BASE_URL;
if (baseUrl.length > 1 && baseUrl.endsWith("/")) {
  baseUrl = baseUrl.slice(0, -1);
}

const { data } = Astro.props;
---

<main
  class="text-gray-900 dark:text-gray-100 font-sans px-4 sm:px-6 pt-10 pb-20 max-w-5xl mx-auto"
>
  <!-- Title block -->
  <header class="mb-10">
    <h1 class="text-4xl font-semibold text-gray-900 dark:text-gray-100">
      {data.name}
    </h1>
  </header>

  <article class="space-y-10">
    <!-- DESCRIPTION -->
    <p
      class="text-base leading-relaxed text-gray-600 dark:text-gray-400"
      set:html={marked.parseInline(data.description)}
    />

    <!-- SYNTAX -->
    <section id="syntax" class="space-y-4 scroll-mt-20">
      <h2 class="text-2xl font-semibold text-gray-900 dark:text-gray-100">
        <a
          href="#syntax"
          class="hover:text-gray-600 dark:hover:text-gray-400 transition-colors"
          aria-label="Link to Syntax & allowed values section"
        >
          Syntax & Values
        </a>
      </h2>
      <pre
        class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 overflow-x-auto text-sm font-mono text-gray-800 dark:text-gray-200 whitespace-pre-wrap"
        set:text={data.syntax.code}
      />
      <p
        class="text-base leading-relaxed text-gray-600 dark:text-gray-400"
        set:html={marked.parseInline(data.syntax.description)}
      />
    </section>

    <!-- CODE EXAMPLES -->
    <section id="examples" class="space-y-4 scroll-mt-20">
      <h2 class="text-2xl font-semibold text-gray-900 dark:text-gray-100">
        <a
          href="#examples"
          class="hover:text-gray-600 dark:hover:text-gray-400 transition-colors"
          aria-label="Link to Code examples section"
        >
          Examples
        </a>
      </h2>
      <div class="space-y-4">
        {
          data.examples.server && (
            <div>
              <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">
                SERVER
              </h3>
              <pre
                class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 overflow-x-auto text-sm font-mono text-gray-800 dark:text-gray-200 whitespace-pre-wrap"
                set:text={data.examples.server}
              />
            </div>
          )
        }
        {
          data.examples.client && (
            <div>
              <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">
                CLIENT
              </h3>
              <pre
                class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 overflow-x-auto text-sm font-mono text-gray-800 dark:text-gray-200 whitespace-pre-wrap"
                set:text={data.examples.client}
              />
            </div>
          )
        }
      </div>
    </section>

    <!-- ERRORS -->
    {
      data.errors.length > 0 && (
        <section id="errors" class="space-y-8 scroll-mt-20">
          <h2 class="text-2xl font-semibold text-gray-900 dark:text-gray-100">
            <a
              href="#errors"
              class="hover:text-gray-600 dark:hover:text-gray-400 transition-colors"
              aria-label="Link to Common errors & fixes section"
            >
              Common Errors & Fixes
            </a>
          </h2>
          {data.errors.map(({ msg, fix }) => (
            <div class="space-y-2">
              <h3
                class="text-lg font-medium text-gray-900 dark:text-gray-100"
                set:html={marked.parseInline(msg)}
              />
              <p
                class="text-base leading-relaxed text-gray-600 dark:text-gray-400"
                set:html={marked.parseInline(fix)}
              />
            </div>
          ))}
        </section>
      )
    }

    <!-- FAQ -->
    <section id="faq" class="space-y-8 scroll-mt-20">
      <h2 class="text-2xl font-semibold text-gray-900 dark:text-gray-100">
        <a
          href="#faq"
          class="hover:text-gray-600 dark:hover:text-gray-400 transition-colors"
          aria-label="Link to Frequently asked questions section"
        >
          Frequently Asked Questions
        </a>
      </h2>
      {
        data.faq.map(({ q, a }) => (
          <div class="space-y-2">
            <h3
              class="text-lg font-medium text-gray-900 dark:text-gray-100"
              set:html={marked.parseInline(q)}
            />
            <p
              class="text-base leading-relaxed text-gray-600 dark:text-gray-400"
              set:html={marked.parseInline(a)}
            />
          </div>
        ))
      }
    </section>
  </article>
</main>
